# eラーニングシステム AWS構成 パラメーター定義ヒアリングシート

**案件名:** eラーニングシステム構築
**作成日:** 2025年11月8日
**対象リージョン:** 東京リージョン (ap-northeast-1)

---

## 0. プロジェクト基本情報・命名規則

| 項目                   | 質問内容                      | 回答 | 目的                               | 推奨値・備考                                         |
| :--------------------- | :---------------------------- | :--- | :--------------------------------- | :--------------------------------------------------- |
| プロジェクト名（英語） | プロジェクトの英語名は？      |      | リソース命名規則の基礎として使用   | 例: elearning, learning-platform                     |
| 環境識別子             | 環境の識別子は？              |      | 本番・検証環境の識別とリソース分離 | 推奨: prod（本番）, stg（ステージング）, dev（開発） |
| システム略称           | システムの略称は？（2-4文字） |      | 短縮形での識別とタグ付けに使用     | 例: el, lms, edu                                     |

### アベイラビリティゾーン（AZ）選定

| 項目                | 質問内容                      | 回答 | 目的                                   | 推奨値・備考                                        |
| :------------------ | :---------------------------- | :--- | :------------------------------------- | :-------------------------------------------------- |
| 使用するAZの数      | 何個のAZを使用する？          |      | 冗長性レベルとコストのバランス決定     | 推奨: 2個（冗長性とコストのバランス）               |
| 第1AZ               | 第1アベイラビリティゾーンは？ |      | プライマリAZとしてリソースを配置       | 推奨: ap-northeast-1a（東京リージョンAZ-A）         |
| 第2AZ               | 第2アベイラビリティゾーンは？ |      | セカンダリAZとして冗長化リソースを配置 | 推奨: ap-northeast-1c（東京リージョンAZ-C）         |
| 第3AZ（オプション） | 第3アベイラビリティゾーンは？ |      | さらなる冗長性確保（高可用性要件時）   | オプション: ap-northeast-1d（高可用性が必要な場合） |

#### AZ選定の考慮事項

**東京リージョン（ap-northeast-1）の利用可能なAZ:**
- **ap-northeast-1a**: 最も一般的に使用されるAZ
- **ap-northeast-1c**: 1aと組み合わせて使用されることが多い
- **ap-northeast-1d**: 追加の冗長性が必要な場合に使用

**推奨構成（2AZ構成）:**
- **第1AZ**: ap-northeast-1a
- **第2AZ**: ap-northeast-1c
- この構成で、ALB、EC2、RDS、NAT Gatewayを各AZに配置

**3AZ構成を検討すべきケース:**
- 金融機関など、極めて高い可用性が求められる場合
- ダウンタイムが事業に重大な影響を与える場合
- コスト増（約1.5倍）を許容できる場合

**AZ選定時の注意点:**
- 各AZは物理的に独立したデータセンター
- AZ間のデータ転送は有料（GB単位で課金）
- 命名規則でAZ識別子（1a、1c、1d）を使用

### 命名規則テンプレート

以下の命名規則を使用して、AWS リソース名を統一します：

#### 基本フォーマット
```
{プロジェクト名}-{環境}-{リソースタイプ}-{用途}-{連番}
```

#### 具体例
| リソース              | 命名例                                 | 説明                                                   |
| :-------------------- | :------------------------------------- | :----------------------------------------------------- |
| VPC                   | `elearning-prod-vpc`                   | プロジェクト名-環境-vpc                                |
| Public Subnet         | `elearning-prod-subnet-public-1a`      | AZ識別子を末尾に追加                                   |
| Private Subnet (App)  | `elearning-prod-subnet-private-app-1a` | 用途（app/db）を明記                                   |
| Private Subnet (DB)   | `elearning-prod-subnet-private-db-1a`  | 用途（app/db）を明記                                   |
| Internet Gateway      | `elearning-prod-igw`                   | プロジェクト名-環境-igw                                |
| NAT Gateway           | `elearning-prod-natgw-1a`              | AZ識別子を追加                                         |
| Route Table (Public)  | `elearning-prod-rtb-public`            | 用途を明記                                             |
| Route Table (Private) | `elearning-prod-rtb-private-1a`        | AZ別に作成                                             |
| Security Group (ALB)  | `elearning-prod-sg-alb`                | 用途を明記                                             |
| Security Group (EC2)  | `elearning-prod-sg-ec2`                | 用途を明記                                             |
| Security Group (RDS)  | `elearning-prod-sg-rds`                | 用途を明記                                             |
| ALB                   | `elearning-prod-alb`                   | プロジェクト名-環境-alb                                |
| Target Group          | `elearning-prod-tg-ec2`                | ターゲットを明記                                       |
| Launch Template       | `elearning-prod-lt-ec2`                | プロジェクト名-環境-lt-ec2                             |
| Auto Scaling Group    | `elearning-prod-asg-ec2`               | プロジェクト名-環境-asg-ec2                            |
| RDS Cluster           | `elearning-prod-aurora-cluster`        | プロジェクト名-環境-aurora-cluster                     |
| RDS Instance (Writer) | `elearning-prod-aurora-writer`         | 役割を明記                                             |
| RDS Instance (Reader) | `elearning-prod-aurora-reader-1`       | 連番を追加                                             |
| S3 Bucket (教材)      | `elearning-prod-contents-{account-id}` | 用途を明記、グローバルで一意にするためアカウントID追加 |
| S3 Bucket (ログ)      | `elearning-prod-logs-{account-id}`     | 用途を明記                                             |
| S3 Bucket (ALBログ)   | `elearning-prod-alb-logs-{account-id}` | 用途を明記                                             |
| CloudWatch Log Group  | `/aws/elearning/prod/application`      | パス形式で階層化                                       |
| IAM Role (EC2)        | `elearning-prod-role-ec2`              | 用途を明記                                             |
| SNS Topic             | `elearning-prod-sns-alerts`            | 用途を明記                                             |
| CloudWatch Alarm      | `elearning-prod-alarm-ec2-cpu-high`    | 監視対象と条件を明記                                   |

#### タグ戦略
すべてのリソースに以下のタグを付与：

| タグキー    | 説明                             | 目的                                 | 例                                  |
| :---------- | :------------------------------- | :----------------------------------- | :---------------------------------- |
| Name        | リソース名（上記命名規則に従う） | リソースの識別と管理                 | elearning-prod-vpc                  |
| Environment | 環境識別子                       | 環境別のリソース分離とフィルタリング | prod / stg / dev                    |
| Project     | プロジェクト名                   | プロジェクト別のリソース管理         | elearning                           |
| ManagedBy   | 管理方法                         | インフラ管理方法の明確化             | Terraform / CloudFormation / Manual |
| CostCenter  | コストセンター（任意）           | 部門別コスト配分                     | education-dept                      |
| Owner       | 責任者（任意）                   | 責任者の明確化と連絡先管理           | itachi-san                          |

---

## 1. システム規模・性能要件

| 項目               | 質問内容                                        | 回答 | 目的                                          | 推奨値・備考                                                         |
| :----------------- | :---------------------------------------------- | :--- | :-------------------------------------------- | :------------------------------------------------------------------- |
| 同時接続ユーザー数 | ピーク時に想定される同時接続数は？              |      | EC2インスタンスタイプとAuto Scaling設定の決定 | 100人未満: t3.small / 100-500人: t3.medium / 500人以上: t3.large以上 |
| 登録ユーザー総数   | システム全体で何名程度の利用を想定？            |      | データベース容量とストレージ設計              | データベース容量設計に影響                                           |
| 動画配信の有無     | e-ラーニングで動画コンテンツを配信しますか？    |      | CloudFront導入とストレージ戦略の検討          | 配信する場合はCloudFrontの検討も必要                                 |
| 動画容量・画質     | 動画を配信する場合、1本あたりの容量と総本数は？ |      | S3ストレージクラスとコスト試算                | S3ストレージクラスとコスト試算に影響                                 |
| レスポンス要件     | ページ表示速度の目標は？（例：3秒以内）         |      | ALBとEC2のスペック選定、キャッシュ戦略        | ALBとEC2のスペック選定に影響                                         |

---

## 2. Auto Scaling設定

| 項目               | 質問内容                               | 回答 | 目的                                 | 推奨値・備考                           |
| :----------------- | :------------------------------------- | :--- | :----------------------------------- | :------------------------------------- |
| 最小インスタンス数 | 常時稼働させる最小のEC2台数は？        |      | 基本的な冗長性確保とコスト最小化     | 推奨: 2台（各AZに1台ずつで冗長性確保） |
| 最大インスタンス数 | ピーク時の上限台数は？                 |      | ピーク負荷対応とコスト上限の設定     | 推奨: 4-8台（予算とピーク負荷による）  |
| スケールアウト閾値 | CPU使用率何%でインスタンスを増やすか？ |      | 負荷増加時の自動スケーリングトリガー | 推奨: 70%                              |
| スケールイン閾値   | CPU使用率何%でインスタンスを減らすか？ |      | 負荷減少時のコスト最適化             | 推奨: 30%                              |
| クールダウン時間   | スケーリング後の待機時間（秒）         |      | スケーリングの安定化と過剰反応防止   | 推奨: 300秒（5分）                     |

---

## 3. EC2インスタンス仕様

| 項目                 | 質問内容                         | 回答 | 目的                                     | 推奨値・備考                                     |
| :------------------- | :------------------------------- | :--- | :--------------------------------------- | :----------------------------------------------- |
| インスタンスタイプ   | どの程度のスペックを想定？       |      | 性能とコストのバランス決定               | 推奨: t3.small（2vCPU, 2GB RAM）から開始         |
| OS                   | 希望のOSは？                     |      | 運用コストとAWS最適化の考慮              | 推奨: Amazon Linux 2023（無償、AWS最適化済み）   |
| アプリケーション言語 | 使用する言語・フレームワークは？ |      | ミドルウェアとランタイム環境の準備       | PHP/Laravel、Python/Django、Node.js/Express など |
| Webサーバー          | ApacheかNginxか？                |      | Webサーバーの性能とリソース使用量        | 推奨: Nginx（軽量・高性能）                      |
| AMI更新頻度          | OSやミドルウェアの更新頻度は？   |      | セキュリティパッチ適用とメンテナンス計画 | 月次パッチ適用を推奨                             |

### EBS（Elastic Block Store）ボリューム設定

| 項目                     | 質問内容                                         | 回答 | 目的                                   | 推奨値・備考                                                                                          |
| :----------------------- | :----------------------------------------------- | :--- | :------------------------------------- | :---------------------------------------------------------------------------------------------------- |
| ルートボリュームサイズ   | OSとアプリケーション用のボリュームサイズは？     |      | システム全体の基本ストレージ容量       | 推奨: 20GB（OS + アプリケーション + 一時ログ）                                                        |
| ボリュームタイプ         | どのEBSボリュームタイプを使用？                  |      | ストレージ性能とコストのバランス       | 推奨: gp3（汎用SSD、コスト効率が良い）                                                                |
| IOPS設定                 | 必要なIOPS（秒間I/O操作数）は？                  |      | ディスクI/O性能の要件確認              | gp3デフォルト: 3,000 IOPS（無料）<br>高負荷時: 最大16,000 IOPSまで増設可能                            |
| スループット設定         | 必要なスループット（MB/s）は？                   |      | 大容量ファイル処理の性能要件           | gp3デフォルト: 125 MB/s（無料）<br>高負荷時: 最大1,000 MB/sまで増設可能                               |
| 追加データボリューム     | アプリケーションデータ用の追加ボリュームは必要？ |      | ルートボリュームとデータの分離管理     | 通常は不要（S3にデータ保存を推奨）<br>大容量ローカルキャッシュが必要な場合のみ検討                    |
| EBS暗号化                | ボリュームを暗号化する？                         |      | データ保護とコンプライアンス対応       | 推奨: 有効化（AWS KMS、追加コストなし）                                                               |
| スナップショット取得     | EBSスナップショットの取得頻度は？                |      | ボリュームレベルのバックアップ計画     | 推奨: AMIバックアップに含まれるため個別取得は不要<br>特定ボリュームのみバックアップが必要な場合は週次 |
| スナップショット保持期間 | スナップショットを何世代保持？                   |      | バックアップ保持期間とストレージコスト | 推奨: 4世代（1ヶ月分）、AMIと同期                                                                     |
| 削除時の保護             | インスタンス削除時にボリュームも削除する？       |      | 誤削除防止とストレージ管理             | 推奨: ルートボリュームは削除（DeleteOnTermination: true）<br>データボリュームは保持（false）          |

### EBSボリュームタイプの比較

| ボリュームタイプ                  | 用途             | IOPS                    | スループット    | 月額コスト（20GB） | 推奨ケース                               |
| :-------------------------------- | :--------------- | :---------------------- | :-------------- | :----------------- | :--------------------------------------- |
| **gp3（汎用SSD）**                | 汎用ワークロード | 3,000〜16,000           | 125〜1,000 MB/s | ¥240               | 推奨: ほとんどのケース                   |
| **gp2（汎用SSD）**                | 汎用ワークロード | 100〜16,000（容量比例） | 最大250 MB/s    | ¥300               | 旧世代、gp3より高コスト                  |
| **io2（プロビジョンドIOPS SSD）** | 高IOPS要件       | 100〜64,000             | 最大1,000 MB/s  | ¥1,950 + IOPS課金  | データベース等、高性能が必要な場合のみ   |
| **st1（スループット最適化HDD）**  | ビッグデータ処理 | -                       | 最大500 MB/s    | ¥135               | 大容量・低頻度アクセス                   |
| **sc1（コールドHDD）**            | アーカイブ       | -                       | 最大250 MB/s    | ¥45                | 最低コスト、アクセス頻度が極めて低い場合 |

**推奨: gp3を選択する理由:**
- gp2より約20%安価
- IOPSとスループットを独立して調整可能
- デフォルト性能（3,000 IOPS、125 MB/s）で大半のワークロードに対応
- 必要に応じて性能を後から増強可能

### EBS性能要件の判断基準

**通常のWebアプリケーション（推奨: gp3デフォルト）:**
- 同時接続: 100〜500人
- IOPS: 3,000 IOPS（デフォルト）で十分
- スループット: 125 MB/s（デフォルト）で十分
- 月額コスト: 約¥240（20GB）

**高負荷Webアプリケーション（gp3 + IOPS増強）:**
- 同時接続: 500人以上
- IOPS: 5,000〜10,000 IOPS
- スループット: 250〜500 MB/s
- 月額コスト: 約¥240 + IOPS追加費用

**データベースサーバー（io2検討）:**
- トランザクション処理が多い
- IOPS: 10,000 IOPS以上
- 低レイテンシが必須
- 月額コスト: 高額（RDS Auroraを推奨）

### EBSコスト試算（東京リージョン）

**基本構成（gp3、20GB × 2インスタンス）:**
- ストレージ: ¥240/月 × 2 = ¥480/月
- スナップショット（4世代、増分バックアップ）: 約¥120/月
- 合計: 約¥600/月

**IOPS増強時の追加コスト:**
- 3,000 IOPS（デフォルト）: 無料
- 5,000 IOPS: +¥300/月
- 10,000 IOPS: +¥1,050/月

**スループット増強時の追加コスト:**
- 125 MB/s（デフォルト）: 無料
- 250 MB/s: +¥150/月
- 500 MB/s: +¥450/月

### EBS運用のベストプラクティス

**推奨設定:**
1. ボリュームタイプ: gp3（コスト効率が最も良い）
2. サイズ: 20GB（OS + アプリケーション）
3. IOPS: 3,000（デフォルト）から開始、必要に応じて増強
4. 暗号化: 有効化（AWS KMS）
5. DeleteOnTermination: true（Auto Scalingで自動削除）
6. スナップショット: AMIバックアップに含まれるため個別取得不要

**避けるべき設定:**
- gp2の使用（gp3より高コスト）
- 過剰なボリュームサイズ（未使用領域でもコスト発生）
- io2の安易な使用（コストが非常に高い）
- 暗号化なし（セキュリティリスク）

**監視すべきメトリクス:**
- VolumeReadOps / VolumeWriteOps（IOPS使用状況）
- VolumeReadBytes / VolumeWriteBytes（スループット使用状況）
- BurstBalance（gp2のみ、バーストクレジット残量）
- VolumeQueueLength（I/O待機キューの長さ）

**パフォーマンス問題発生時の対応:**
1. CloudWatchでEBSメトリクスを確認
2. IOPS/スループットが上限に達している場合は増強
3. アプリケーションログをS3に移行してディスクI/O削減
4. 静的コンテンツをS3/CloudFrontに移行

---

## 4. RDS Aurora MySQL構成

| 項目                   | 質問内容                         | 回答 | 目的                                     | 推奨値・備考                                                                                               |
| :--------------------- | :------------------------------- | :--- | :--------------------------------------- | :--------------------------------------------------------------------------------------------------------- |
| インスタンスクラス     | どの程度のスペック？             |      | データベース性能とコストのバランス       | 推奨: db.t3.small（2vCPU, 2GB RAM）から開始                                                                |
| エンジンバージョン     | MySQL互換のバージョンは？        |      | アプリケーション互換性と新機能の利用     | 推奨: Aurora MySQL 3.x（MySQL 8.0互換）                                                                    |
| 初期ストレージ容量     | データベースの初期容量見込みは？ |      | ストレージ容量計画とコスト見積もり       | Auroraは10GBから自動拡張（最大128TB）                                                                      |
| Read Replicaの数       | 読み取り専用レプリカは何台？     |      | 読み取り負荷分散と冗長性確保             | 推奨: 1台（各AZに1台ずつ、計2台構成）                                                                      |
| メンテナンスウィンドウ | メンテナンス時間帯の希望は？     |      | サービス影響を最小化するメンテナンス時間 | 推奨: 火曜日 03:00-04:00 JST（アクセス最小時間帯）                                                         |
| 暗号化                 | データベース暗号化は必要？       |      | データ保護とセキュリティコンプライアンス | 推奨: 有効化（セキュリティベストプラクティス）                                                             |
| データベースログ       | どのログを有効化する？           |      | トラブルシューティングとセキュリティ監査 | 推奨: 監査ログ + スロークエリログ（コスト重視）<br>全ログ: 監査 + 接続 + 一般 + スロークエリ（詳細分析時） |

### RDSバックアップ・可用性設定

| 項目                       | 質問内容                             | 回答 | 目的                                   | 推奨値・備考                                                                                 |
| :------------------------- | :----------------------------------- | :--- | :------------------------------------- | :------------------------------------------------------------------------------------------- |
| 自動バックアップ           | 自動バックアップを有効化する？       |      | データ損失防止と復旧可能性の確保       | 推奨: 有効（必須、Aurora標準機能）                                                           |
| バックアップ保持期間       | 何日分のバックアップを保持？         |      | データ復旧可能期間とストレージコスト   | 推奨: 7日間（コストと復旧要件のバランス）<br>最大35日間まで設定可能                          |
| バックアップウィンドウ     | バックアップ実行時間帯の希望は？     |      | バックアップ実行時のパフォーマンス影響 | 推奨: 02:00-03:00 JST（アクセス最小時間帯、メンテナンスウィンドウと重複しないように）        |
| ポイントインタイムリカバリ | PITRを使用する？                     |      | 任意の時点へのデータベース復元         | 推奨: 有効（自動バックアップ有効化で自動的に利用可能、5分以内の任意の時点に復元可能）        |
| 削除保護                   | データベースの削除保護を有効化する？ |      | 誤削除防止とデータ保護                 | 推奨: 有効（本番環境では必須、開発環境では無効でも可）                                       |
| 拡張モニタリング           | 拡張モニタリングを有効化する？       |      | 詳細なパフォーマンスメトリクスの取得   | 推奨: 有効（60秒間隔、本番環境）<br>開発環境: 無効またはコスト削減                           |
| 拡張モニタリング粒度       | モニタリングデータの収集間隔は？     |      | モニタリングの詳細度とコストのバランス | 推奨: 60秒（本番環境）<br>選択肢: 1秒、5秒、10秒、15秒、30秒、60秒<br>短い間隔ほどコスト増加 |

### RDS認証設定

| 項目                              | 質問内容                                     | 回答 | 目的                                         | 推奨値・備考                                                                                                |
| :-------------------------------- | :------------------------------------------- | :--- | :------------------------------------------- | :---------------------------------------------------------------------------------------------------------- |
| データベース認証方法              | どの認証方法を使用する？                     |      | データベースアクセスの認証方式決定           | 推奨: パスワード認証（標準）<br>オプション: IAM認証、Kerberos認証                                           |
| IAMデータベース認証               | IAMデータベース認証を有効化する？            |      | IAMロールによるデータベースアクセス制御      | 推奨: 無効（パスワード認証で十分）<br>有効化すべきケース: Lambda等のAWSサービスから直接アクセスする場合     |
| マスターユーザー名                | マスターユーザー名は？                       |      | データベース管理者アカウントの設定           | 推奨: admin（デフォルト）または任意の名前<br>セキュリティ上、rootやadministratorは避ける                    |
| マスターパスワード管理            | マスターパスワードの管理方法は？             |      | 認証情報の安全な管理                         | 推奨: AWS Secrets Managerで管理（自動ローテーション可能）<br>手動管理も可能だが定期的なローテーションが必要 |
| Secrets Manager自動ローテーション | パスワードの自動ローテーションを有効化する？ |      | 定期的なパスワード変更によるセキュリティ強化 | 推奨: 有効（90日間隔）<br>自動ローテーション時はアプリケーション側で新パスワードを自動取得する仕組みが必要  |

#### 自動バックアップの考慮事項

**自動バックアップの仕組み:**
- Aurora は自動的に継続的バックアップを実行
- データベースボリュームの増分スナップショットを自動的に取得
- トランザクションログを継続的にS3にバックアップ
- バックアップウィンドウ中にスナップショットを作成（パフォーマンス影響は最小限）

**ポイントインタイムリカバリ（PITR）:**
- 自動バックアップ有効化で自動的に利用可能
- 保持期間内の任意の時点（5分以内の精度）に復元可能
- 復元時は新しいクラスターとして作成される
- 本番環境では必須の機能

**バックアップ保持期間の選択基準:**
- 7日間: 標準的な要件、週次での復旧が可能
- 14日間: より長期の復旧要件がある場合
- 35日間: コンプライアンス要件で長期保持が必要な場合
- 保持期間が長いほどストレージコストが増加

**バックアップウィンドウの設定:**
- アクセスが最も少ない時間帯を選択
- メンテナンスウィンドウと重複しないように設定
- 推奨: 深夜2:00-3:00（メンテナンス: 3:00-4:00）

#### 削除保護の考慮事項

**削除保護を有効化すべき理由:**
- 誤操作によるデータベース削除を防止
- 本番環境では必須のセキュリティ対策
- 削除保護が有効な場合、削除前に保護を無効化する必要がある（二段階の確認）

**削除保護の動作:**
- 有効化時: コンソール、CLI、APIからの削除操作が拒否される
- 削除するには: まず削除保護を無効化 → その後削除操作を実行
- 最終スナップショットの取得オプションも利用可能

**環境別の推奨設定:**
- 本番環境: 有効（必須）
- ステージング環境: 有効（推奨）
- 開発環境: 無効（コスト削減とテスト容易性のため）

#### 拡張モニタリングの考慮事項

**拡張モニタリングで取得できるメトリクス:**
- CPU使用率（詳細）
- メモリ使用率
- ディスクI/O
- ネットワークトラフィック
- プロセスリスト
- ファイルシステム使用状況

**標準モニタリングとの違い:**
- 標準モニタリング: ハイパーバイザーレベルのメトリクス（無料）
- 拡張モニタリング: OSレベルの詳細なメトリクス（有料）
- 拡張モニタリングの方がより詳細なトラブルシューティングが可能

**粒度とコストの関係:**
- 1秒間隔: 最も詳細だが高コスト（約¥1,500/月/インスタンス）
- 60秒間隔: 標準的な詳細度（約¥150/月/インスタンス）
- 本番環境では60秒間隔を推奨
- 開発環境では無効化してコスト削減

**推奨設定（本番環境）:**
- 拡張モニタリング: 有効
- 粒度: 60秒間隔
- コスト: 約¥300/月（Writer + Reader）

#### データベース認証の考慮事項

**パスワード認証（推奨）:**
- 最も一般的で実装が容易
- Secrets Managerと組み合わせて安全に管理
- アプリケーションから接続文字列で認証

**IAMデータベース認証:**
- IAMロールを使用してデータベースに接続
- パスワード不要、一時的な認証トークンを使用
- Lambda、ECS等のAWSサービスから接続する場合に有効
- 通常のWebアプリケーションではパスワード認証で十分

**Secrets Managerによるパスワード管理の利点:**
- パスワードを暗号化して安全に保存
- アプリケーションコードにパスワードをハードコーディングしない
- 自動ローテーション機能で定期的にパスワード変更
- IAMポリシーでアクセス制御

**自動ローテーションの注意点:**
- ローテーション時にアプリケーションが新パスワードを自動取得する必要がある
- アプリケーション側でSecrets Manager SDKを使用して実装
- ローテーション中の接続エラーハンドリングが必要
- 初期構築時は手動ローテーションから始めることも可能

**推奨設定:**
- 認証方法: パスワード認証
- パスワード管理: AWS Secrets Manager
- 自動ローテーション: 有効（90日間隔）
- IAM認証: 無効（必要に応じて後から有効化可能）

### データベースログの種類と選択

Aurora MySQLでは複数のログタイプが利用可能です。予算とトラブルシューティング要件に応じて選択してください。

| ログタイプ           | 用途                                   | CloudWatchコスト影響 | 推奨設定                   |
| :------------------- | :------------------------------------- | :------------------- | :------------------------- |
| **監査ログ**         | セキュリティ監査、コンプライアンス対応 | 中                   | 本番環境では必須           |
| **スロークエリログ** | パフォーマンス問題の特定               | 低〜中               | 本番環境では必須           |
| **接続ログ**         | 接続エラーのトラブルシューティング     | 中                   | 接続問題が頻発する場合のみ |
| **一般ログ**         | 全クエリの記録（デバッグ用）           | 高                   | 開発環境のみ推奨           |

**コスト重視の推奨構成（本番環境）:**
- 監査ログ: 有効
- スロークエリログ: 有効（実行時間 > 2秒）
- 接続ログ: 無効（必要時のみ有効化）
- 一般ログ: 無効

**詳細分析が必要な場合:**
- 全てのログを有効化
- CloudWatchコストが月額 +¥3,000〜¥5,000 増加する可能性あり
- ログ保持期間を短く設定（7日間）してコスト抑制

---

## 5. S3利用

| 項目                   | 質問内容                             | 回答 | 目的                                 | 推奨値・備考                            |
| :--------------------- | :----------------------------------- | :--- | :----------------------------------- | :-------------------------------------- |
| 教材データ容量         | 画像・教材ファイルの総容量見込みは？ |      | ストレージ容量計画とコスト試算       | 初期容量と月次増加量を確認              |
| アクセス頻度           | 頻繁にアクセスされるか？             |      | 最適なストレージクラスの選定         | 頻繁: S3 Standard / 低頻度: S3 IA       |
| ログ保持期間           | アプリケーションログを何日分保持？   |      | トラブルシューティングとコスト最適化 | 推奨: 90日（調査用）、その後Glacier移行 |
| バージョニング         | S3バージョニングは必要？             |      | 誤削除・上書きからのデータ保護       | 推奨: 教材データは有効化、ログは無効    |
| ライフサイクルポリシー | 古いデータの自動削除・移行は？       |      | ストレージコストの自動最適化         | 推奨: 90日後にGlacier、365日後に削除    |
| ALBログ保持期間        | ALBアクセスログの保持期間は？        |      | アクセス分析とセキュリティ監査       | 推奨: 30日間                            |

---

## 6. ネットワーク・セキュリティ

### VPC基本設定

| 項目                      | 質問内容                                   | 回答 | 目的                                         | 推奨値・備考                                 |
| :------------------------ | :----------------------------------------- | :--- | :------------------------------------------- | :------------------------------------------- |
| VPC CIDR                  | VPCのIPアドレス範囲は？                    |      | ネットワーク全体のIPアドレス空間の確保       | 推奨: 10.0.0.0/16（65,536個のIPアドレス）    |
| IPv6の有効化              | VPCでIPv6を有効化する？                    |      | IPv6対応の必要性確認                         | 推奨: 無効（IPv4のみで十分、管理が簡素化）   |
| Public Subnet CIDR        | パブリックサブネットのCIDRは？             |      | インターネット接続リソース用のIP範囲         | 推奨: AZ-a: 10.0.1.0/24, AZ-c: 10.0.2.0/24   |
| Private Subnet (App) CIDR | アプリ層プライベートサブネットは？         |      | アプリケーションサーバー用の隔離されたIP範囲 | 推奨: AZ-a: 10.0.11.0/24, AZ-c: 10.0.12.0/24 |
| Private Subnet (DB) CIDR  | DB層プライベートサブネットは？             |      | データベース用のさらに隔離されたIP範囲       | 推奨: AZ-a: 10.0.21.0/24, AZ-c: 10.0.22.0/24 |
| DNS解決                   | VPC内でDNS解決を有効化する？               |      | VPC内のリソース名前解決                      | 推奨: 有効（enableDnsSupport: true）         |
| DNSホスト名               | EC2インスタンスにDNSホスト名を割り当てる？ |      | インスタンスへのDNS名でのアクセス            | 推奨: 有効（enableDnsHostnames: true）       |

### サブネット設定

| 項目                                           | 質問内容                                               | 回答 | 目的                                           | 推奨値・備考                                                                           |
| :--------------------------------------------- | :----------------------------------------------------- | :--- | :--------------------------------------------- | :------------------------------------------------------------------------------------- |
| パブリックサブネットのパブリックIP自動割り当て | パブリックサブネットでパブリックIPを自動割り当てする？ |      | パブリックサブネット内リソースへの外部アクセス | 推奨: 無効（ALBのみパブリックサブネットに配置、EC2はプライベートサブネット配置を推奨） |

#### パブリックIP自動割り当ての考慮事項

**パブリックIP自動割り当てを無効にする理由（推奨）:**
- EC2インスタンスはプライベートサブネットに配置（セキュリティベストプラクティス）
- ALBがパブリックサブネットに配置され、外部からのアクセスを受け付ける
- EC2への直接的な外部アクセスを防止し、ALB経由のみに制限
- 不要なパブリックIPの割り当てを避け、セキュリティリスクを低減
- NAT Gateway経由で外部への通信を制御

**パブリックIP自動割り当てを有効化すべきケース:**
- パブリックサブネットに踏み台サーバー（Bastion Host）を配置する場合
- 開発環境で一時的にEC2に直接アクセスする必要がある場合
- NAT Gatewayを使用せず、EC2から直接外部へアクセスさせる場合（非推奨）

**本システムの推奨構成:**
```
パブリックサブネット:
- ALB: パブリックIPあり（自動割り当て）
- NAT Gateway: Elastic IP割り当て
- パブリックIP自動割り当て: 無効

プライベートサブネット（App層）:
- EC2インスタンス: パブリックIPなし
- ALB経由でのみ外部からアクセス可能
- NAT Gateway経由で外部へアクセス

プライベートサブネット（DB層）:
- RDS Aurora: パブリックIPなし
- EC2からのみアクセス可能
```

**セキュリティ上の注意点:**
- パブリックIP自動割り当てを有効化すると、Auto Scalingで起動するEC2インスタンスすべてにパブリックIPが割り当てられる
- パブリックIPが割り当てられたEC2は、セキュリティグループの設定ミスにより外部から直接アクセスされるリスクがある
- 本番環境では、EC2をプライベートサブネットに配置し、パブリックIP自動割り当ては無効化することを強く推奨

**コスト影響:**
- パブリックIP自動割り当て自体は無料
- ただし、不要なパブリックIPの割り当ては管理の複雑化とセキュリティリスクを招く

#### IPv6設定の考慮事項

**IPv6を無効にする理由（推奨）:**
- eラーニングシステムではIPv4のみで十分
- セキュリティグループルールの管理が簡素化
- IPv6特有の設定ミスによるセキュリティリスクを回避
- 運用・監視の複雑性を削減

**IPv6を有効化すべきケース:**
- グローバルなサービスでIPv6対応が必須の場合
- ISPやキャリアからIPv6のみでアクセスされる可能性がある場合
- 将来的なIPv4アドレス枯渇への対応が必要な場合

**IPv6有効化時の追加設定:**
- VPCにIPv6 CIDRブロックを割り当て（/56）
- 各サブネットにIPv6 CIDRブロックを割り当て（/64）
- ルートテーブルにIPv6用のルート追加（::/0 → IGW）
- セキュリティグループにIPv6ルール追加
- ALBでdualstack設定を有効化

### WAF・DDoS対策

| 項目                | 質問内容                                 | 回答 | 目的                                       | 推奨値・備考                                          |
| :------------------ | :--------------------------------------- | :--- | :----------------------------------------- | :---------------------------------------------------- |
| WAFの必要性         | AWS WAFでWebアプリケーション保護は必要？ |      | Webアプリケーション層の攻撃防御            | 推奨: 本番環境では有効化（SQLインジェクション等対策） |
| WAFマネージドルール | AWSマネージドルールを使用する？          |      | 一般的な脅威への自動防御                   | 推奨: Core Rule Set + Known Bad Inputs                |
| レート制限          | 特定IPからの過剰なリクエストを制限する？ |      | DDoS攻撃やブルートフォース攻撃の防止       | 推奨: 100リクエスト/5分/IP                            |
| 地理的制限          | 特定の国・地域からのアクセスを制限する？ |      | 地理的なアクセス制御によるセキュリティ強化 | 例: 日本のみ許可、または特定国をブロック              |

### インバウンド通信制御（外部からVPCへ）

| 項目                | 質問内容                                 | 回答 | 目的                                         | 推奨値・備考                               |
| :------------------ | :--------------------------------------- | :--- | :------------------------------------------- | :----------------------------------------- |
| ALBアクセス元IP制限 | ALBへのアクセスを特定IPに制限する？      |      | 不正アクセスの防止（全体または管理画面のみ） | セキュリティグループまたはWAF IP Setで制御 |
| 許可するIP範囲      | アクセスを許可するIPアドレス範囲は？     |      | インバウンドアクセス制御ルールの設定         | 例: 全公開 or 会社IP: 203.0.113.0/24       |
| 地理的制限          | 特定の国・地域からのアクセスを制限する？ |      | 地理的なアクセス制御によるセキュリティ強化   | WAF Geo Matchで日本のみ許可など            |

### アウトバウンド通信制御（VPCから外部へ）

| 項目                       | 質問内容                                         | 回答 | 目的                                         | 推奨値・備考                                       |
| :------------------------- | :----------------------------------------------- | :--- | :------------------------------------------- | :------------------------------------------------- |
| アウトバウンド制限の必要性 | プライベートサブネットからの外部通信を制限する？ |      | データ流出防止とセキュリティコンプライアンス | 推奨: 必要最小限の通信のみ許可                     |
| 許可する外部サービス       | どの外部サービスへの通信を許可する？             |      | 必要な外部サービスへのアクセス確保           | 例: AWS API、OS更新サーバー、外部API               |
| AWS サービスエンドポイント | VPC Endpointを使用する？                         |      | NAT Gateway経由せずAWSサービスへ直接接続     | 推奨: S3、DynamoDB（コスト削減・セキュリティ向上） |
| OS更新サーバー             | OSパッケージ更新サーバーへのアクセスは？         |      | セキュリティパッチ適用のための通信確保       | Amazon Linux: amazonlinux.*.amazonaws.com          |
| 外部API通信                | 外部APIサービスへの通信は必要？                  |      | 決済、メール送信、SMS等の外部サービス連携    | 必要に応じてドメイン・IPを指定                     |
| NTP サーバー               | 時刻同期サーバーへのアクセスは？                 |      | システム時刻の正確性確保                     | Amazon Time Sync Service（169.254.169.123）推奨    |

### アウトバウンド制御の実装方法

| 制御方法                                         | 実装場所        | 制御粒度                                       | 推奨用途                                   |
| :----------------------------------------------- | :-------------- | :--------------------------------------------- | :----------------------------------------- |
| **セキュリティグループ（アウトバウンドルール）** | EC2インスタンス | IPアドレス、ポート、プロトコル                 | 基本的なアウトバウンド制御                 |
| **ネットワークACL**                              | サブネット      | IPアドレス、ポート、プロトコル（ステートレス） | サブネット全体の制御                       |
| **VPC Endpoint**                                 | VPC             | AWSサービスへの直接接続                        | S3、DynamoDB等へのプライベート接続         |
| **AWS Network Firewall**                         | VPC             | ドメイン、URL、IPアドレス（ステートフル）      | 高度なアウトバウンド制御が必要な場合       |
| **プロキシサーバー**                             | EC2インスタンス | ドメイン、URL、コンテンツフィルタリング        | 詳細なログ記録・フィルタリングが必要な場合 |

### アウトバウンド制御の推奨構成

**基本構成（コスト重視）:**
- セキュリティグループで必要最小限のポート・プロトコルのみ許可
- VPC Endpoint（S3、DynamoDB）を使用してNAT Gateway経由の通信を削減
- 外部への通信は必要なサービスのみ許可（HTTPS: 443、HTTP: 80）

**セキュリティ重視構成:**
- セキュリティグループで厳格なアウトバウンドルール設定
- VPC Endpointで主要AWSサービスへの接続を確保
- ネットワークACLでサブネットレベルの制御を追加
- CloudWatch Logsでフロー ログを記録・監視

**高度なセキュリティ構成（金融機関等）:**
- AWS Network Firewallでドメインベースのフィルタリング
- 許可リスト方式（ホワイトリスト）で明示的に許可された通信のみ
- VPC Flow Logsで全通信を記録・分析
- 定期的なログ監査とアラート設定

### アウトバウンド制御時の考慮事項

**必ず許可すべき通信:**
- AWS API エンドポイント（Systems Manager、CloudWatch等）
- OSパッケージ更新サーバー（セキュリティパッチ適用）
- NTPサーバー（時刻同期）
- DNS（名前解決）

**業務要件に応じて許可する通信:**
- 外部決済API（Stripe、PayPal等）
- メール送信サービス（SendGrid、SES等）
- SMS送信サービス
- 外部認証サービス（OAuth、SAML等）
- CDN（CloudFront、Fastly等）

**コスト影響:**
- VPC Endpoint（Gateway型: S3、DynamoDB）: 無料
- VPC Endpoint（Interface型: その他AWSサービス）: 約¥1,080/月/エンドポイント
- AWS Network Firewall: 約¥45,000/月（高額、高度なセキュリティ要件時のみ）
- NAT Gateway削減効果: VPC Endpoint使用でデータ転送費削減可能

### IAMロール設定

| 項目                | 質問内容                                            | 回答 | 目的                                    | 推奨値・備考                                             |
| :------------------ | :-------------------------------------------------- | :--- | :-------------------------------------- | :------------------------------------------------------- |
| **EC2用IAMロール**  | EC2インスタンスに付与する権限は？                   |      | EC2からAWSサービスへのアクセス制御      | 推奨: S3読み取り、CloudWatch Logs書き込み、SSM管理       |
| S3アクセス権限      | どのS3バケットへのアクセスが必要？                  |      | 教材データやログへのアクセス制御        | 推奨: 教材バケット（読み取り）、ログバケット（書き込み） |
| CloudWatch Logs権限 | アプリケーションログをCloudWatchに送信する？        |      | ログの集約管理と監視                    | 推奨: 有効（PutLogEvents、CreateLogStream）              |
| Systems Manager権限 | SSM経由でのEC2管理を有効化する？                    |      | セキュアなサーバーアクセスとパッチ管理  | 推奨: 有効（AmazonSSMManagedInstanceCore）               |
| Secrets Manager権限 | データベース認証情報をSecrets Managerから取得する？ |      | 認証情報の安全な管理                    | 推奨: 有効（特定シークレットの読み取りのみ）             |
| **RDS用IAMロール**  | RDS拡張モニタリング用のロールは？                   |      | RDSの詳細なパフォーマンスメトリクス取得 | 推奨: 有効（AmazonRDSEnhancedMonitoringRole）            |
| RDS監視レベル       | 拡張モニタリングの粒度は？                          |      | モニタリングの詳細度とコストのバランス  | 推奨: 60秒間隔（本番環境）、無効（開発環境）             |

#### IAMロールのベストプラクティス

**EC2 IAMロールの推奨ポリシー構成:**
```
1. AmazonSSMManagedInstanceCore（AWS管理ポリシー）
   - Systems Manager経由のアクセス
   - パッチ管理、セッションマネージャー

2. CloudWatchAgentServerPolicy（AWS管理ポリシー）
   - CloudWatch Logsへのログ送信
   - カスタムメトリクスの送信

3. カスタムポリシー（S3アクセス）
   - 教材バケット: s3:GetObject, s3:ListBucket
   - ログバケット: s3:PutObject

4. カスタムポリシー（Secrets Manager）
   - 特定シークレットの読み取りのみ
   - secretsmanager:GetSecretValue
```

**最小権限の原則:**
- 必要最小限の権限のみ付与
- ワイルドカード（*）の使用を避ける
- リソースARNを明示的に指定
- 定期的な権限レビューと不要な権限の削除

**IAMロール命名規則:**
- EC2ロール: `{プロジェクト名}-{環境}-role-ec2`
- RDSモニタリングロール: `{プロジェクト名}-{環境}-role-rds-monitoring`

### セキュリティグループ設定

#### ALB用セキュリティグループ

| 項目             | 質問内容                               | 回答 | 目的                                 | 推奨値・備考                                        |
| :--------------- | :------------------------------------- | :--- | :----------------------------------- | :-------------------------------------------------- |
| HTTP許可         | HTTPアクセス（ポート80）を許可する？   |      | HTTPからHTTPSへのリダイレクト用      | 推奨: 許可（HTTPSへリダイレクト）                   |
| HTTPS許可        | HTTPSアクセス（ポート443）を許可する？ |      | セキュアな通信の提供                 | 推奨: 許可（必須）                                  |
| アクセス元IP制限 | ALBへのアクセスを特定IPに制限する？    |      | 不正アクセスの防止                   | 全公開 or 会社IP制限（管理画面のみ制限も可）        |
| 許可するIP範囲   | アクセスを許可するIPアドレス範囲は？   |      | インバウンドアクセス制御ルールの設定 | 例: 0.0.0.0/0（全公開） or 203.0.113.0/24（会社IP） |

**ALB セキュリティグループ推奨設定:**
```
インバウンドルール:
- HTTP (80): 0.0.0.0/0 → HTTPSへリダイレクト用
- HTTPS (443): 0.0.0.0/0 → メインアクセス

アウトバウンドルール:
- カスタムTCP (アプリポート): EC2セキュリティグループへ
```

#### EC2用セキュリティグループ

| 項目                   | 質問内容                                      | 回答 | 目的                           | 推奨値・備考                                            |
| :--------------------- | :-------------------------------------------- | :--- | :----------------------------- | :------------------------------------------------------ |
| アプリケーションポート | アプリケーションが使用するポート番号は？      |      | ALBからEC2への通信許可         | 例: 80（HTTP）、8080（アプリサーバー）、3000（Node.js） |
| ALBからのアクセス      | ALBセキュリティグループからのみアクセス許可？ |      | セキュアな通信経路の確保       | 推奨: ALB SGのみ許可（ソースにALB SGを指定）            |
| SSH接続                | SSH接続（ポート22）を許可する？               |      | 緊急時のサーバーアクセス手段   | 推奨: 特定IP + SSMを主要手段とする                      |
| SSH接続元IP            | SSH接続を許可するIPアドレスは？               |      | SSH接続元の制限                | 例: 203.0.113.0/24（会社）、198.51.100.50/32（自宅）    |
| 内部通信               | EC2インスタンス間の通信は必要？               |      | セッション共有やクラスタリング | 必要に応じて同一SG内の通信を許可                        |

**EC2 セキュリティグループ推奨設定:**
```
インバウンドルール:
- カスタムTCP (アプリポート): ALBセキュリティグループから
- SSH (22): 管理者IPアドレスから（予備手段）

アウトバウンドルール:
- HTTPS (443): 0.0.0.0/0 → AWS API、外部API、パッケージ更新
- MySQL/Aurora (3306): RDSセキュリティグループへ
- DNS (53): 0.0.0.0/0 → 名前解決
- NTP (123): 0.0.0.0/0 → 時刻同期
```

#### RDS用セキュリティグループ

| 項目               | 質問内容                                      | 回答 | 目的                               | 推奨値・備考                                       |
| :----------------- | :-------------------------------------------- | :--- | :--------------------------------- | :------------------------------------------------- |
| データベースポート | 使用するデータベースポートは？                |      | データベース接続の許可             | MySQL/Aurora: 3306、PostgreSQL: 5432               |
| EC2からのアクセス  | EC2セキュリティグループからのみアクセス許可？ |      | データベースへのアクセス制限       | 推奨: EC2 SGのみ許可（ソースにEC2 SGを指定）       |
| 管理者アクセス     | 開発者PCから直接RDSに接続する？               |      | 開発・デバッグ時のデータベース接続 | 推奨: 本番環境は不許可、開発環境のみ特定IPから許可 |
| 管理者接続元IP     | 管理者接続を許可するIPアドレスは？            |      | 管理者アクセスの制限               | 例: 203.0.113.0/24（会社）※開発環境のみ            |

**RDS セキュリティグループ推奨設定:**
```
インバウンドルール:
- MySQL/Aurora (3306): EC2セキュリティグループから
- MySQL/Aurora (3306): 管理者IP（開発環境のみ）

アウトバウンドルール:
- 不要（RDSからの外部接続は通常不要）
```

#### セキュリティグループ設計のベストプラクティス

**階層化されたセキュリティ:**
```
インターネット
    ↓ (HTTPS: 443)
ALB セキュリティグループ
    ↓ (アプリポート: 80/8080/3000等)
EC2 セキュリティグループ
    ↓ (MySQL: 3306)
RDS セキュリティグループ
```

**推奨設定のポイント:**
1. **ソースにセキュリティグループIDを指定**: IPアドレスではなくSG IDを使用することで、動的なIPにも対応
2. **最小権限の原則**: 必要最小限のポート・プロトコルのみ許可
3. **アウトバウンドルールの制限**: デフォルトの「すべて許可」から必要な通信のみに変更
4. **本番環境と開発環境の分離**: 本番環境では管理者の直接アクセスを制限
5. **定期的なレビュー**: 不要になったルールの削除

**セキュリティグループ命名規則:**
- ALB: `{プロジェクト名}-{環境}-sg-alb`
- EC2: `{プロジェクト名}-{環境}-sg-ec2`
- RDS: `{プロジェクト名}-{環境}-sg-rds`

### EC2アクセス方法の設定

| 項目                 | 質問内容                           | 回答     | 目的                                           | 推奨値・備考                                         |
| :------------------- | :--------------------------------- | :------- | :--------------------------------------------- | :--------------------------------------------------- |
| **主要アクセス方法** | Systems Manager (SSM)              | 有効     | セキュアなサーバーアクセスとセッションログ記録 | セキュアかつコスト効率的（踏み台サーバー不要）       |
| **予備アクセス方法** | SSH公開鍵認証                      | 設定推奨 | SSM障害時のフェイルオーバーアクセス手段        | SSM障害時の予備手段として環境構築後に設定            |
| SSH接続元IP制限      | SSH接続を特定IPに制限する？        |          | 不正アクセスの防止とセキュリティ強化           | 推奨: 会社・自宅の固定IPのみ許可                     |
| SSH接続元IP一覧      | 許可するIPアドレスは？             |          | セキュリティグループルールの設定               | 例: 203.0.113.0/24（会社）、198.51.100.50/32（自宅） |
| SSHポート番号        | デフォルトの22番を使用？変更する？ |          | SSHポートの設定（標準または変更）              | 推奨: 22番（変更してもセキュリティ向上効果は限定的） |

### アクセス方法の使い分け

| アクセス方法              | 用途                       | メリット                                                                  | デメリット                                                               |
| :------------------------ | :------------------------- | :------------------------------------------------------------------------ | :----------------------------------------------------------------------- |
| **Systems Manager (SSM)** | 通常運用時のメインアクセス | ・踏み台サーバー不要<br>・IAMで権限管理<br>・セッションログ記録<br>・無料 | ・SSM障害時は使用不可<br>・IAM設定が必要                                 |
| **SSH公開鍵認証**         | SSM障害時の予備手段        | ・SSMに依存しない<br>・直接接続可能                                       | ・セキュリティグループ設定必要<br>・鍵管理が必要<br>・ログ記録は別途設定 |

### SSH公開鍵設定の実装方針

**環境構築時の対応:**
1. Launch Templateに公開鍵を設定せず、SSMのみで構築
2. 環境構築完了後、動作確認を実施
3. SSMでの接続が安定稼働することを確認

**予備SSH設定の追加（構築後）:**
1. セキュリティグループにSSH（ポート22）のインバウンドルールを追加
   - ソース: 管理者のIPアドレスのみ
   - プロトコル: TCP
   - ポート: 22（または指定されたポート番号）
2. 運用開始後、管理者から公開鍵を収集し、SSM経由で`~/.ssh/authorized_keys`に追加
3. SSH接続テストを実施
4. 接続ログの記録設定を確認

**注意事項:**
- 公開鍵の管理（数、管理者名、ローテーション等）は運用フェーズで対応
- インフラ構築時はSSH接続を許可するIP範囲とポート番号のみ設定

---

## 7. 監視・アラート（CloudWatch）

| 項目                            | 質問内容                                | 回答 | 目的                                     | 推奨値・備考                                         |
| :------------------------------ | :-------------------------------------- | :--- | :--------------------------------------- | :--------------------------------------------------- |
| 監視項目                        | 何を監視する？                          |      | システムの健全性とパフォーマンス監視     | 推奨: CPU、メモリ、ディスク、ネットワーク、RDS接続数 |
| CPU使用率アラート               | CPU使用率何%で警告？                    |      | リソース不足の早期検知と対応             | 推奨: Warning 70%, Critical 85%                      |
| メモリ使用率アラート            | メモリ使用率何%で警告？                 |      | メモリ枯渇によるサービス停止の防止       | 推奨: Warning 80%, Critical 90%                      |
| RDS接続数アラート               | DB接続数の閾値は？                      |      | データベース接続プールの枯渇防止         | インスタンスタイプの最大接続数の80%を推奨            |
| アラート通知先                  | どこに通知する？                        |      | 障害発生時の迅速な通知手段               | Email、Slack、SNSなど                                |
| 通知先メールアドレス            | アラート受信用のメールアドレスは？      |      | アラート通知の送信先設定                 | 複数設定可能                                         |
| ログ保持期間（CloudWatch Logs） | CloudWatch Logsの保持期間は？           |      | ログ分析期間とストレージコストのバランス | 推奨: 30日（コスト削減のため、その後S3へ）           |
| カスタムメトリクス              | EC2のメモリ・ディスク使用率を監視する？ |      | 詳細なリソース監視とアラート設定         | CloudWatch Agentで取得可能（追加コスト発生）         |

### CloudWatch監視のコスト考慮事項

**標準メトリクス（無料）:**
- EC2: CPU使用率、ネットワーク、ディスクI/O
- RDS: CPU使用率、接続数、ストレージ使用量
- ALB: リクエスト数、レイテンシ、ターゲット健全性

**カスタムメトリクス（有料）:**
- EC2のメモリ使用率、ディスク使用率
- CloudWatch Agent経由で取得
- コスト: 約¥450/月（10メトリクス × 2インスタンス）

**ログ取り込みコスト:**
- アプリケーションログ: 約¥750/月（10GB想定）
- RDSログ（全種類有効化時）: 約¥3,000〜¥5,000/月
- ALBアクセスログ: S3保存推奨（CloudWatchより安価）

**推奨設定（コスト重視）:**
- 標準メトリクスのみ使用
- カスタムメトリクスは必要最小限（メモリ監視のみ等）
- RDSログは監査 + スロークエリのみ
- アプリケーションログは重要なもののみCloudWatchへ

---

## 8. ドメイン・DNS（Route 53）

| 項目             | 質問内容                           | 回答 | 目的                              | 推奨値・備考                                |
| :--------------- | :--------------------------------- | :--- | :-------------------------------- | :------------------------------------------ |
| ドメイン名       | 使用するドメイン名は？             |      | サービスのURL決定とDNS設定        | 仮: example.com（後で変更可能）             |
| サブドメイン構成 | サブドメインは使用する？           |      | 機能別・環境別のURL分離           | 例: www.example.com, api.example.com        |
| ホストゾーン     | 既存ドメインの移管か、新規取得か？ |      | DNS管理方法とネームサーバー設定   | Route 53でのホストゾーン作成方法に影響      |
| TTL設定          | DNSレコードのTTL値は？             |      | DNS変更の反映速度とキャッシュ制御 | 推奨: 300秒（5分）、本番後は3600秒（1時間） |

---

## 9. SSL/TLS証明書（ACM）

| 項目           | 質問内容                     | 回答 | 目的                           | 推奨値・備考                              |
| :------------- | :--------------------------- | :--- | :----------------------------- | :---------------------------------------- |
| 証明書の種類   | ワイルドカード証明書が必要？ |      | 複数サブドメインへの証明書適用 | 推奨: *.example.com（サブドメイン全対応） |
| 証明書検証方法 | DNS検証かEmail検証か？       |      | 証明書発行と自動更新の方法     | 推奨: DNS検証（自動更新が容易）           |

---

## 10. コスト管理・予算

| 項目                   | 質問内容                                 | 回答 | 目的                           | 推奨値・備考                           |
| :--------------------- | :--------------------------------------- | :--- | :----------------------------- | :------------------------------------- |
| 月額予算上限           | 月額コストの上限目安は？                 |      | 運用コストの上限設定と予算管理 | 初期構成で月額3-5万円程度を想定        |
| 初期構築費用           | 初期構築にかけられる予算は？             |      | プロジェクト全体の予算計画     | 設計・構築・テスト費用                 |
| コストアラート         | 予算の何%で通知？                        |      | 予算超過の早期検知と対応       | 推奨: 80%, 100%, 120%で段階的に通知    |
| リザーブドインスタンス | 1年後にRIやSavings Plansを検討？         |      | 長期的なコスト最適化計画       | 安定稼働後、30-50%のコスト削減可能     |
| コスト配分タグ         | 部門別・機能別にコストを分けて管理する？ |      | 詳細なコスト分析と配賦         | Cost Allocation Tagsで詳細な分析が可能 |

### 想定月額コスト試算（初期構成）

以下は最小構成での概算です（東京リージョン、2025年11月時点）：

| サービス            | 構成                          | 月額概算（USD） | 月額概算（JPY） | 備考                            |
| :------------------ | :---------------------------- | :-------------- | :-------------- | :------------------------------ |
| **EC2**             | t3.small × 2台（常時）        | $30             | ¥4,500          | Auto Scaling最小構成            |
| **ALB**             | 1台 + データ転送              | $25             | ¥3,750          | 基本料金 + 処理量               |
| **RDS Aurora**      | db.t3.small × 2台             | $80             | ¥12,000         | Writer + Reader                 |
| **NAT Gateway**     | 2台（各AZ）                   | $65             | ¥9,750          | 基本料金 + データ転送           |
| **S3**              | 100GB + リクエスト            | $5              | ¥750            | 教材データ + ログ               |
| **Route 53**        | ホストゾーン + クエリ         | $1              | ¥150            | ドメイン管理                    |
| **CloudWatch**      | ログ + メトリクス（最小構成） | $10             | ¥1,500          | 標準メトリクス + アプリログ10GB |
| **Systems Manager** | 無料                          | $0              | ¥0              | EC2接続用                       |
| **データ転送**      | 外部への転送                  | $10             | ¥1,500          | 想定50GB/月                     |
| **合計**            | -                             | **$226**        | **¥33,900**     | 1USD = 150円換算                |

**CloudWatch内訳（最小構成: ¥1,500/月）:**
- 標準メトリクス: 無料
- アプリケーションログ（10GB）: ¥750
- RDSログ（監査 + スロークエリ）: ¥750

**CloudWatch拡張時の追加コスト:**
- カスタムメトリクス（メモリ・ディスク）: +¥450/月
- RDS全ログ有効化: +¥2,250〜¥3,500/月
- アプリログ増量（30GB）: +¥1,500/月

### コスト最適化オプション

| 最適化施策                   | 削減効果         | 実施タイミング | 備考                           |
| :--------------------------- | :--------------- | :------------- | :----------------------------- |
| **NAT Gateway削減**          | -$32/月          | 初期から可能   | 1台のみ配置（冗長性は低下）    |
| **RDS Aurora Serverless v2** | -20〜40%         | 初期から可能   | アクセス変動が大きい場合に有効 |
| **EC2 Savings Plans**        | -30%             | 6ヶ月後        | 利用パターンが安定してから     |
| **RDS Reserved Instance**    | -40%             | 6ヶ月後        | 1年または3年契約               |
| **S3 Intelligent-Tiering**   | -20〜40%         | 初期から可能   | アクセス頻度に応じて自動最適化 |
| **CloudFront導入**           | データ転送費削減 | 動画配信時     | S3直接アクセスより安価         |

### ピーク時のコスト増加見込み

| シナリオ   | EC2台数        | 月額増加 | 備考                   |
| :--------- | :------------- | :------- | :--------------------- |
| 通常時     | 2台            | -        | ベースライン           |
| 軽度ピーク | 4台（平均3台） | +$15     | 夕方〜夜間のみスケール |
| 中度ピーク | 6台（平均4台） | +$30     | 試験期間など           |
| 高度ピーク | 8台（平均5台） | +$45     | 新学期開始時など       |

### 予算管理の推奨設定

| 予算項目   | 金額     | アラート設定             |
| :--------- | :------- | :----------------------- |
| 月次予算   | ¥40,000  | 80%（¥32,000）で警告     |
| 四半期予算 | ¥120,000 | 90%（¥108,000）で警告    |
| 年間予算   | ¥480,000 | 予測ベースで超過時に通知 |

---

## 11. バックアップ・災害対策

| 項目                | 質問内容                       | 回答 | 目的                                   | 推奨値・備考                               |
| :------------------ | :----------------------------- | :--- | :------------------------------------- | :----------------------------------------- |
| RTO（目標復旧時間） | 障害発生時、何時間以内に復旧？ |      | サービス復旧目標時間の設定             | マルチAZ構成で自動フェイルオーバー（数分） |
| RPO（目標復旧時点） | データ損失は何分まで許容？     |      | データ損失許容範囲の設定               | Aurora自動バックアップで5分以内            |
| AMIバックアップ頻度 | EC2のAMI取得頻度は？           |      | サーバー構成のバックアップ計画         | 推奨: 週次（日曜深夜）                     |
| AMI保持世代数       | AMIを何世代保持？              |      | バックアップ保持期間とストレージコスト | 推奨: 4世代（1ヶ月分）                     |

---

## 12. 運用・保守

| 項目             | 質問内容                           | 回答 | 目的                                 | 推奨値・備考                         |
| :--------------- | :--------------------------------- | :--- | :----------------------------------- | :----------------------------------- |
| デプロイ方法     | アプリケーションのデプロイ方法は？ |      | アプリケーション更新の自動化レベル   | CodeDeploy、GitHub Actions、手動など |
| パッチ適用方法   | OSやミドルウェアのパッチ適用は？   |      | セキュリティパッチの適用方法と自動化 | Systems Manager Patch Managerを推奨  |
| 定期メンテナンス | 定期メンテナンスの頻度と時間帯は？ |      | 計画的なメンテナンス実施計画         | 推奨: 月次、日曜深夜                 |
| 運用担当者       | 運用を担当する人数と体制は？       |      | アクセス権限とIAMポリシーの設計      | SSMアクセス権限設定に影響            |

---

**記入担当者:** _______________
**記入日:** _______________
